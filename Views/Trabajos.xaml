<Page x:Class="Proyecto_taller.Views.Trabajos"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Módulo de Trabajos"
      Background="#2C3E50">

    <Page.Resources>
        <!-- Estilos DataGrid mejorados con colores más claros -->
        <Style TargetType="DataGrid">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#DFE3E8"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="RowBackground" Value="White"/>
            <Setter Property="AlternatingRowBackground" Value="#FAFBFC"/>
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="SelectionUnit" Value="FullRow"/>
            <Setter Property="CanUserResizeRows" Value="False"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="RowHeight" Value="45"/>
            <Setter Property="ColumnHeaderHeight" Value="42"/>
        </Style>

        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#F8F9FA"/>
            <Setter Property="Foreground" Value="#495057"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="BorderThickness" Value="0,0,0,2"/>
            <Setter Property="BorderBrush" Value="#DEE2E6"/>
        </Style>

        <Style TargetType="DataGridCell">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#E7F3FF"/>
                    <Setter Property="Foreground" Value="#0066CC"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="DataGridRow">
            <Setter Property="Background" Value="White"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F1F3F5"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#E7F3FF"/>
                </Trigger>
                <DataTrigger Binding="{Binding Estado}" Value="Pendiente">
                    <Setter Property="Background" Value="#FFF8E1"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Estado}" Value="En Progreso">
                    <Setter Property="Background" Value="#E3F2FD"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Estado}" Value="Finalizado">
                    <Setter Property="Background" Value="#E8F5E9"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- ⭐ NUEVO: Estilo para ComboBox dentro del DataGrid -->
        <Style x:Key="EstadoComboBox" TargetType="ComboBox">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="11"/>
            <Style.Triggers>
                <!-- Color según el estado -->
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=SelectedValue}" Value="Pendiente">
                    <Setter Property="Foreground" Value="#F57C00"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=SelectedValue}" Value="En Progreso">
                    <Setter Property="Foreground" Value="#1976D2"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=SelectedValue}" Value="Finalizado">
                    <Setter Property="Foreground" Value="#388E3C"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Botones modernos con colores Bootstrap -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="#0066CC"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="Margin" Value="4,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#0052A3"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#003D7A"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DeleteButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background" Value="#DC3545"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#C82333"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SuccessButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background" Value="#28A745"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#218838"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SecondaryButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background" Value="#6C757D"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#5A6268"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="WarningButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background" Value="#FFC107"/>
            <Setter Property="Foreground" Value="#212529"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E0A800"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Page.Resources>

    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="86*"/>
            <ColumnDefinition Width="11*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="15"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header mejorado -->
        <Border Grid.Row="0" Background="White" CornerRadius="6" Padding="20,16"
                BorderBrush="#2C3E50" BorderThickness="1" Grid.ColumnSpan="2" Margin="0,0,0,15" Grid.RowSpan="2">
            <Border.Effect>
                <DropShadowEffect Color="#000000" Direction="270" ShadowDepth="1" BlurRadius="6" Opacity="0.08"/>
            </Border.Effect>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="12"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="12"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Título con badge -->
                <Grid Grid.Row="0">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Border Background="#0066CC" CornerRadius="6" Padding="8" Margin="0,0,12,0">
                            <TextBlock Text="🔧" FontSize="20" />
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Gestión de Trabajos" 
                                      FontSize="20" 
                                      FontWeight="SemiBold"
                                      Foreground="#212529"/>
                            <TextBlock Text="Administra órdenes de servicio y reparaciones" 
                                      FontSize="11" 
                                      Foreground="#6C757D"
                                      Margin="0,2,0,0"/>
                        </StackPanel>
                    </StackPanel>
                </Grid>

                <!-- Barra de acciones -->
                <StackPanel Grid.Row="2" Orientation="Horizontal">
                    <Button Content="🔄 Actualizar" 
                            Command="{Binding CargarTrabajosCommand}" 
                            Style="{StaticResource SecondaryButton}"/>
                    <Button Content="➕ Nuevo Trabajo" 
                            Command="{Binding AgregarTrabajoCommand}" 
                            Style="{StaticResource ModernButton}"/>
                    <Button Content="🛠️ Servicios y Repuestos" 
                            Command="{Binding GestionarServiciosRepuestosCommand}" 
                            Style="{StaticResource WarningButton}"/>
                    <Button Content="✅ Finalizar" 
                            Command="{Binding FinalizarTrabajoCommand}" 
                            Style="{StaticResource SuccessButton}"/>
                    <Button Content="🗑️ Eliminar" 
                            Command="{Binding EliminarTrabajoCommand}" 
                            Style="{StaticResource DeleteButton}"/>
                </StackPanel>

                <!-- Filtros mejorados -->
                <Border Grid.Row="4" 
                        Background="#F8F9FA" 
                        CornerRadius="4" 
                        Padding="12,8">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Filtrar por estado:" 
                                  VerticalAlignment="Center" 
                                  Margin="0,0,12,0"
                                  FontWeight="Medium" 
                                  FontSize="11"
                                  Foreground="#495057"/>
                        <RadioButton Content="📋 Todos" 
                                    IsChecked="{Binding FiltroTodos}" 
                                    GroupName="Filtro" 
                                    Margin="0,0,12,0" 
                                    VerticalAlignment="Center"
                                    FontSize="11"/>
                        <RadioButton Content="⏳ Pendientes" 
                                    IsChecked="{Binding FiltroPendientes}" 
                                    GroupName="Filtro" 
                                    Margin="0,0,12,0" 
                                    VerticalAlignment="Center"
                                    FontSize="11"/>
                        <RadioButton Content="🔄 En Progreso" 
                                    IsChecked="{Binding FiltroEnProgreso}" 
                                    GroupName="Filtro" 
                                    Margin="0,0,12,0" 
                                    VerticalAlignment="Center"
                                    FontSize="11"/>
                        <RadioButton Content="✅ Finalizados" 
                                    IsChecked="{Binding FiltroFinalizados}" 
                                    GroupName="Filtro" 
                                    VerticalAlignment="Center"
                                    FontSize="11"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- DataGrid mejorado -->
        <Border Grid.Row="2" Background="#2C3E50" CornerRadius="6"
                BorderBrush="#2C3E50" BorderThickness="1" Grid.ColumnSpan="2">
            <Border.Effect>
                <DropShadowEffect Color="#000000" Direction="270" ShadowDepth="1" BlurRadius="6" Opacity="0.08"/>
            </Border.Effect>

            <DataGrid x:Name="dgTrabajos"
                      ItemsSource="{Binding Trabajos}" 
                      SelectedItem="{Binding TrabajoSeleccionado}" 
                      Margin="0">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" Binding="{Binding TrabajoID}" Width="60" IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="Foreground" Value="#0066CC"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Vehículo" Binding="{Binding Vehiculo.Marca}" Width="110">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontWeight" Value="Medium"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Modelo" Binding="{Binding Vehiculo.Modelo}" Width="110"/>
                    <DataGridTextColumn Header="Placa" Binding="{Binding Vehiculo.Placa}" Width="90">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontFamily" Value="Consolas"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Cliente" Binding="{Binding Vehiculo.Cliente.Nombre}" Width="*"/>
                    <DataGridTextColumn Header="Descripción" Binding="{Binding Descripcion}" Width="*"/>
                    <DataGridTextColumn Header="Tipo" Binding="{Binding TipoTrabajo}" Width="120"/>

                    <!-- ⭐ NUEVA COLUMNA: ComboBox para cambiar el estado -->
                    <DataGridTemplateColumn Header="Estado" Width="130">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ComboBox SelectedValue="{Binding Estado, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource EstadoComboBox}"
                                         SelectionChanged="EstadoComboBox_SelectionChanged">
                                    <ComboBoxItem Content="⏳ Pendiente" Tag="Pendiente"/>
                                    <ComboBoxItem Content="🔄 En Progreso" Tag="En Progreso"/>
                                    <ComboBoxItem Content="✅ Finalizado" Tag="Finalizado"/>
                                </ComboBox>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn Header="Fecha Ingreso" Binding="{Binding FechaIngreso, StringFormat=dd/MM/yyyy}" Width="110"/>

                    <DataGridTextColumn Header="Precio Est." Binding="{Binding PrecioEstimado, StringFormat=Bs. {0:N2}}" Width="100">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#6C757D"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Precio Final" Binding="{Binding PrecioFinal, StringFormat=Bs. {0:N2}}" Width="100">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="Foreground" Value="#28A745"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
    </Grid>
</Page>
